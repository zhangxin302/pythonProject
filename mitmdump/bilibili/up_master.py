"""
author:张鑫
date:2021/5/6 9:52
咬人猫
https://app.bilibili.com/x/v2/space/archive?access_key=1c1c28ef37ba0b01717878a56b31eb51&appkey=1d8b6e7d45233436&build=6140500&c_locale=zh_CN&channel=yingyongbao&fnval=16&fnver=0&force_host=0&fourk=0&mobi_app=android&order=pubdate&platform=android&pn=2&ps=10&qn=32&s_locale=zh_CN&statistics=%7B%22appId%22%3A1%2C%22platform%22%3A3%2C%22version%22%3A%226.14.0%22%2C%22abtest%22%3A%22%22%7D&ts=1620265925&vmid=116683&sign=565e95e00d8f22b56af2a60854c6e903
https://app.bilibili.com/x/v2/space/archive?access_key=1c1c28ef37ba0b01717878a56b31eb51&appkey=1d8b6e7d45233436&build=6140500&c_locale=zh_CN&channel=yingyongbao&fnval=16&fnver=0&force_host=0&fourk=0&mobi_app=android&order=pubdate&platform=android&pn=3&ps=10&qn=32&s_locale=zh_CN&statistics=%7B%22appId%22%3A1%2C%22platform%22%3A3%2C%22version%22%3A%226.14.0%22%2C%22abtest%22%3A%22%22%7D&ts=1620265927&vmid=116683&sign=a77298df8c35c067973fab70732cedbc
https://app.bilibili.com/x/v2/space/archive?access_key=1c1c28ef37ba0b01717878a56b31eb51&appkey=1d8b6e7d45233436&build=6140500&c_locale=zh_CN&channel=yingyongbao&fnval=16&fnver=0&force_host=0&fourk=0&mobi_app=android&order=pubdate&platform=android&pn=2&ps=10&qn=32&s_locale=zh_CN&statistics=%7B%22appId%22%3A1%2C%22platform%22%3A3%2C%22version%22%3A%226.14.0%22%2C%22abtest%22%3A%22%22%7D&ts=1620281606&vmid=116683&sign=c0d2afd6c9f2e494432278337b71b027
https://app.bilibili.com/x/v2/space/archive?access_key=1c1c28ef37ba0b01717878a56b31eb51&appkey=1d8b6e7d45233436&build=6140500&c_locale=zh_CN&channel=yingyongbao&fnval=16&fnver=0&force_host=0&fourk=0&mobi_app=android&order=pubdate&platform=android&pn=3&ps=10&qn=32&s_locale=zh_CN&statistics=%7B%22appId%22%3A1%2C%22platform%22%3A3%2C%22version%22%3A%226.14.0%22%2C%22abtest%22%3A%22%22%7D&ts=1620281609&vmid=116683&sign=e3f7c58e4ac0b9be17d76fb17881e2df
https://app.bilibili.com/x/v2/space/archive?access_key=1c1c28ef37ba0b01717878a56b31eb51&appkey=1d8b6e7d45233436&build=6140500&c_locale=zh_CN&channel=yingyongbao&fnval=16&fnver=0&force_host=0&fourk=0&mobi_app=android&order=pubdate&platform=android&pn=4&ps=10&qn=32&s_locale=zh_CN&statistics=%7B%22appId%22%3A1%2C%22platform%22%3A3%2C%22version%22%3A%226.14.0%22%2C%22abtest%22%3A%22%22%7D&ts=1620281613&vmid=116683&sign=f54cdef70c361c373d5b2ad30ad2757e
https://app.bilibili.com/x/v2/space/archive?access_key=1c1c28ef37ba0b01717878a56b31eb51&appkey=1d8b6e7d45233436&build=6140500&c_locale=zh_CN&channel=yingyongbao&fnval=16&fnver=0&force_host=0&fourk=0&mobi_app=android&order=pubdate&platform=android&pn=5&ps=10&qn=32&s_locale=zh_CN&statistics=%7B%22appId%22%3A1%2C%22platform%22%3A3%2C%22version%22%3A%226.14.0%22%2C%22abtest%22%3A%22%22%7D&ts=1620281660&vmid=116683&sign=87158cf63f4077bd5dd84b81bc7d899f
https://app.bilibili.com/x/v2/space/archive?access_key=1c1c28ef37ba0b01717878a56b31eb51&appkey=1d8b6e7d45233436&build=6140500&c_locale=zh_CN&channel=yingyongbao&fnval=16&fnver=0&force_host=0&fourk=0&mobi_app=android&order=pubdate&platform=android&pn=6&ps=10&qn=32&s_locale=zh_CN&statistics=%7B%22appId%22%3A1%2C%22platform%22%3A3%2C%22version%22%3A%226.14.0%22%2C%22abtest%22%3A%22%22%7D&ts=1620281663&vmid=116683&sign=b426a7afe01e5600d4e0493fd83a1145
https://app.bilibili.com/x/v2/space/archive?access_key=1c1c28ef37ba0b01717878a56b31eb51&appkey=1d8b6e7d45233436&build=6140500&c_locale=zh_CN&channel=yingyongbao&fnval=16&fnver=0&force_host=0&fourk=0&mobi_app=android&order=pubdate&platform=android&pn=7&ps=10&qn=32&s_locale=zh_CN&statistics=%7B%22appId%22%3A1%2C%22platform%22%3A3%2C%22version%22%3A%226.14.0%22%2C%22abtest%22%3A%22%22%7D&ts=1620281666&vmid=116683&sign=288cf7ba9ca8c5925d3e10d4a75901e1
https://app.bilibili.com/x/v2/space/archive?access_key=1c1c28ef37ba0b01717878a56b31eb51&appkey=1d8b6e7d45233436&build=6140500&c_locale=zh_CN&channel=yingyongbao&fnval=16&fnver=0&force_host=0&fourk=0&mobi_app=android&order=pubdate&platform=android&pn=8&ps=10&qn=32&s_locale=zh_CN&statistics=%7B%22appId%22%3A1%2C%22platform%22%3A3%2C%22version%22%3A%226.14.0%22%2C%22abtest%22%3A%22%22%7D&ts=1620281669&vmid=116683&sign=82a6c867f7baf4c46f602869c9d4a749
https://app.bilibili.com/x/v2/space/archive?access_key=1c1c28ef37ba0b01717878a56b31eb51&appkey=1d8b6e7d45233436&build=6140500&c_locale=zh_CN&channel=yingyongbao&fnval=16&fnver=0&force_host=0&fourk=0&mobi_app=android&order=pubdate&platform=android&pn=9&ps=10&qn=32&s_locale=zh_CN&statistics=%7B%22appId%22%3A1%2C%22platform%22%3A3%2C%22version%22%3A%226.14.0%22%2C%22abtest%22%3A%22%22%7D&ts=1620281672&vmid=116683&sign=bfc2c54a8ddebb2831b18c31aa29b6ab
https://app.bilibili.com/x/v2/space/archive?access_key=1c1c28ef37ba0b01717878a56b31eb51&appkey=1d8b6e7d45233436&build=6140500&c_locale=zh_CN&channel=yingyongbao&fnval=16&fnver=0&force_host=0&fourk=0&mobi_app=android&order=pubdate&platform=android&pn=10&ps=10&qn=32&s_locale=zh_CN&statistics=%7B%22appId%22%3A1%2C%22platform%22%3A3%2C%22version%22%3A%226.14.0%22%2C%22abtest%22%3A%22%22%7D&ts=1620281674&vmid=116683&sign=9f3354b5a787507c8f23c6fb6a9fdf5f
https://app.bilibili.com/x/v2/space/archive?access_key=1c1c28ef37ba0b01717878a56b31eb51&appkey=1d8b6e7d45233436&build=6140500&c_locale=zh_CN&channel=yingyongbao&fnval=16&fnver=0&force_host=0&fourk=0&mobi_app=android&order=pubdate&platform=android&pn=11&ps=10&qn=32&s_locale=zh_CN&statistics=%7B%22appId%22%3A1%2C%22platform%22%3A3%2C%22version%22%3A%226.14.0%22%2C%22abtest%22%3A%22%22%7D&ts=1620281677&vmid=116683&sign=3d056e429e87ca71f527ba0adc49ef7b
https://app.biliapi.net/x/v2/space/archive?access_key=1c1c28ef37ba0b01717878a56b31eb51&appkey=1d8b6e7d45233436&build=6140500&c_locale=zh_CN&channel=yingyongbao&fnval=16&fnver=0&force_host=0&fourk=0&mobi_app=android&order=pubdate&platform=android&pn=2&ps=10&qn=32&s_locale=zh_CN&statistics=%7B%22appId%22%3A1%2C%22platform%22%3A3%2C%22version%22%3A%226.14.0%22%2C%22abtest%22%3A%22%22%7D&ts=1620282960&vmid=2743119&sign=ab143dd8b16f7775ed05046da4f57fc3
"""
import json
import random
import time
import pymongo
import requests
import ssl
ssl._create_default_https_context = ssl._create_unverified_context

db = pymongo.MongoClient('localhost', port=27017)
databases = db['bilibili']
up_master = databases['up_master']


def response(flow):
    if 'app.bilibili.com/x/v2/space/archive' in flow.request.url:
        # for item in flow.response.text:
        for item in json.loads(flow.response.text)['data']['item']:
            yaorenmao = {}
            # time.sleep(random.randint(1, 5))
            yaorenmao['author'] = item['author']
            yaorenmao['ctime'] = item['ctime']
            yaorenmao['share_subtitle'] = item['three_point'][1]['share_subtitle']
            yaorenmao['title'] = item['title']

            print(yaorenmao)
            up_master.insert(yaorenmao)
            print(item)

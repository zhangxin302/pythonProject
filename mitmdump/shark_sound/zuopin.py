"""
author:张鑫
date:2021/5/7 9:43
aweme_list>share_info>share_url
https://aweme.snssdk.com/aweme/v1/aweme/post/?source=0&user_avatar_shrink=96_96&video_cover_shrink=248_330&publish_video_strategy_type=2&max_cursor=0&sec_user_id=MS4wLjABAAAAMzD63Edj0LnGYATU_CSXt-6jv9lt8IPETDFkLxtfxxo&show_live_replay_strategy=1&count=20&is_order_flow=0&page_from=2&longitude=101.56358166666665&latitude=31.001249999999995&location_permission=true&os_api=22&device_type=SM-G977N&ssmix=a&manifest_version_code=150201&dpi=320&uuid=351564272622119&app_name=aweme&version_name=15.2.0&ts=1620354165&cpu_support64=false&app_type=normal&appTheme=dark&ac=wifi&host_abi=armeabi-v7a&update_version_code=15209900&channel=aweGW&_rticket=1620354165836&device_platform=android&iid=3413328874713982&version_code=150200&cdid=3697952e-3f20-4137-920b-99fe588f4c6e&openudid=9f1f47b29747b286&device_id=456997632486734&resolution=900*1600&os_version=5.1.1&language=zh&device_brand=Android&aid=1128&minor_status=0&mcc_mnc=46007
https://aweme.snssdk.com/aweme/v1/aweme/post/?source=0&user_avatar_shrink=96_96&video_cover_shrink=248_330&publish_video_strategy_type=2&max_cursor=1616835659000&sec_user_id=MS4wLjABAAAAMzD63Edj0LnGYATU_CSXt-6jv9lt8IPETDFkLxtfxxo&show_live_replay_strategy=1&count=10&is_order_flow=0&page_from=2&longitude=101.56358166666665&latitude=31.001249999999995&location_permission=true&os_api=22&device_type=SM-G977N&ssmix=a&manifest_version_code=150201&dpi=320&uuid=351564272622119&app_name=aweme&version_name=15.2.0&ts=1620357224&cpu_support64=false&app_type=normal&appTheme=dark&ac=wifi&host_abi=armeabi-v7a&update_version_code=15209900&channel=aweGW&_rticket=1620357224197&device_platform=android&iid=3413328874713982&version_code=150200&cdid=3697952e-3f20-4137-920b-99fe588f4c6e&openudid=9f1f47b29747b286&device_id=456997632486734&resolution=900*1600&os_version=5.1.1&language=zh&device_brand=Android&aid=1128&minor_status=0&mcc_mnc=46007
https://aweme.snssdk.com/aweme/v1/aweme/post/?source=0&user_avatar_shrink=96_96&video_cover_shrink=248_330&publish_video_strategy_type=2&max_cursor=1615721060000&sec_user_id=MS4wLjABAAAAMzD63Edj0LnGYATU_CSXt-6jv9lt8IPETDFkLxtfxxo&show_live_replay_strategy=1&count=10&is_order_flow=0&page_from=2&longitude=101.56358166666665&latitude=31.001249999999995&location_permission=true&os_api=22&device_type=SM-G977N&ssmix=a&manifest_version_code=150201&dpi=320&uuid=351564272622119&app_name=aweme&version_name=15.2.0&ts=1620357369&cpu_support64=false&app_type=normal&appTheme=dark&ac=wifi&host_abi=armeabi-v7a&update_version_code=15209900&channel=aweGW&_rticket=1620357369437&device_platform=android&iid=3413328874713982&version_code=150200&cdid=3697952e-3f20-4137-920b-99fe588f4c6e&openudid=9f1f47b29747b286&device_id=456997632486734&resolution=900*1600&os_version=5.1.1&language=zh&device_brand=Android&aid=1128&minor_status=0&mcc_mnc=46007
https://aweme.snssdk.com/aweme/v1/aweme/post/?source=0&user_avatar_shrink=96_96&video_cover_shrink=248_330&publish_video_strategy_type=2&max_cursor=1614425809000&sec_user_id=MS4wLjABAAAAMzD63Edj0LnGYATU_CSXt-6jv9lt8IPETDFkLxtfxxo&show_live_replay_strategy=1&count=10&is_order_flow=0&page_from=2&longitude=101.56358166666665&latitude=31.001249999999995&location_permission=true&os_api=22&device_type=SM-G977N&ssmix=a&manifest_version_code=150201&dpi=320&uuid=351564272622119&app_name=aweme&version_name=15.2.0&ts=1620357512&cpu_support64=false&app_type=normal&appTheme=dark&ac=wifi&host_abi=armeabi-v7a&update_version_code=15209900&channel=aweGW&_rticket=1620357512938&device_platform=android&iid=3413328874713982&version_code=150200&cdid=3697952e-3f20-4137-920b-99fe588f4c6e&openudid=9f1f47b29747b286&device_id=456997632486734&resolution=900*1600&os_version=5.1.1&language=zh&device_brand=Android&aid=1128&minor_status=0&mcc_mnc=46007
https://aweme.snssdk.com/aweme/v1/aweme/post/?source=0&user_avatar_shrink=96_96&video_cover_shrink=248_330&publish_video_strategy_type=2&max_cursor=1610361589000&sec_user_id=MS4wLjABAAAAESdx4ByluNcHp5wsx6gS_bb0Cxi5kVkdPb8e7b5p-yM&show_live_replay_strategy=1&count=10&is_order_flow=0&page_from=2&longitude=101.56358166666665&latitude=31.001249999999995&location_permission=true&os_api=22&device_type=SM-G977N&ssmix=a&manifest_version_code=150201&dpi=320&uuid=351564272622119&app_name=aweme&version_name=15.2.0&ts=1620359028&cpu_support64=false&app_type=normal&appTheme=dark&ac=wifi&host_abi=armeabi-v7a&update_version_code=15209900&channel=aweGW&_rticket=1620359029747&device_platform=android&iid=3413328874713982&version_code=150200&cdid=3697952e-3f20-4137-920b-99fe588f4c6e&openudid=9f1f47b29747b286&device_id=456997632486734&resolution=900*1600&os_version=5.1.1&language=zh&device_brand=Android&aid=1128&minor_status=0&mcc_mnc=46007
"""
import json
import pymongo
import time
import random
database = pymongo.MongoClient('localhost', port=27017)
db = database['douyin']
zuopin = db['zuopin']

def response(flow):
    if 'aweme.snssdk.com/aweme/v1/aweme/post/'in flow.request.url:
        for item in json.loads(flow.response.text)['aweme_list']:
            print('*************************************')
            print(item)
            print('*************************************')
            time.sleep(random.randint(1,5))
            share = {}
            # 作品连接
            share['share_url'] = item['share_info']['share_url']
            # 作者昵称
            share['nickname'] = item['author']['nickname']
            # share['nickname'] = item['author']['nickname']
            # 作者用户id
            share['author_user_id'] = item['author_user_id']
            # 作品描述
            share['desc'] = item['desc']
            # 作品发布时间
            share['create_time'] = item['create_time']

            print('*****************************************')
            print(share)
            print('*****************************************')
            zuopin.insert(share)